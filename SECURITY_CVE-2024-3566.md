# Mitigación CVE-2024-3566 - Inyección de Comandos en Node.js

## Resumen de la Vulnerabilidad

**CVE-2024-3566** es una vulnerabilidad de inyección de comandos que afecta aplicaciones Node.js en Windows que dependen indirectamente de la función `CreateProcess` cuando se satisfacen condiciones específicas.

### Procesos Afectados en SGM
- `bin/npm-cli.js` (npm)
- `bin/vite.js` (vite)

## Mitigaciones Implementadas

### 1. Actualización de Dependencias
- ✅ **Vite**: Actualizado a v7.1.9 (desde v6.3.6)
- ✅ **@vitejs/plugin-react**: Actualizado a v5.0.4 (desde v4.3.4)
- ✅ **npm**: Fijado a v11.6.2 mediante `packageManager`

### 2. Verificación de Versión de Node.js
- ✅ **engines**: Requiere Node.js >=20.19.5
- ✅ **engineStrict**: Falla instalación si versión no cumple
- ✅ **Script preinstall**: Verifica vulnerabilidades conocidas antes de instalar

### 3. Rangos de Versiones Vulnerables Detectados
```javascript
// Versiones de Node.js vulnerables a CVE-2024-3566
'>=18.0.0 <18.20.5'   // Node 18.x
'>=20.0.0 <20.18.0'   // Node 20.x  
'>=22.0.0 <22.9.0'    // Node 22.x
```

## Verificación de Seguridad

### Verificar Versión Actual
```bash
node -v && npm -v
```

### Ejecutar Verificación Manual
```bash
node scripts/check-node.js
```

### Instalar Dependencias (con verificación automática)
```bash
npm install
```

## Actualización en Windows

Si estás en Windows y tienes una versión vulnerable:

### Opción 1: Descarga Oficial
1. Ir a https://nodejs.org/
2. Descargar la versión LTS más reciente (>=20.19.5)
3. Ejecutar el instalador

### Opción 2: Windows Package Manager
```powershell
winget install OpenJS.NodeJS
```

### Opción 3: Chocolatey
```powershell
choco upgrade nodejs
```

### Opción 4: Node Version Manager (nvm-windows)
```cmd
nvm install lts
nvm use lts
```

## Validación Post-Actualización

Después de actualizar Node.js:

1. **Verificar versión**:
   ```bash
   node -v  # Debe ser >=20.19.5
   ```

2. **Reinstalar dependencias**:
   ```bash
   rm -rf node_modules package-lock.json
   npm install
   ```

3. **Probar el desarrollo**:
   ```bash
   npm run dev
   ```

## Estado de Seguridad Actual

- ✅ **Node.js**: v20.19.5 (Seguro)
- ✅ **npm**: v11.6.2 (Última versión)
- ✅ **Vite**: v7.1.9 (Última versión estable)
- ⚠️ **xlsx**: v0.18.5 (Vulnerabilidades menores detectadas, no críticas)

## Referencias

- [CVE-2024-3566 - MITRE](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-3566)
- [Node.js Security Releases](https://nodejs.org/en/blog/vulnerability/)
- [npm Security Advisories](https://github.com/advisories)

---

**Última actualización**: 9 de octubre de 2025  
**Estado**: ✅ Mitigado  
**Responsable**: Sistema automatizado de verificación de seguridad